var previewActive=false;function kPreviewHelper(b){var a=jQuery("#editor");if(a.val()!==null){jQuery.ajax({type:"POST",url:jQuery("#kpreview_url").val(),async:true,dataType:"json",data:{body:a.val()}}).done(function(c){jQuery("#kbbcode-preview").html(c.preview);}).fail(function(){});}}jQuery(document).ready(function(e){var b=e(".qreply");var c=e("#editor");e("#tabs_kunena_editor a:first").tab("show");e("#tabs_kunena_editor a:last").click(function(j){j.preventDefault();var i=e("#kbbcode-preview");var h=e("#editor");i.css("display","block");h.hide();kPreviewHelper();i.attr("class","kbbcode-preview-bottom controls");var g=h.css("height");i.css("height",g);});e("#tabs_kunena_editor a:not(:last)").click(function(g){e("#kbbcode-preview").hide();c.css("display","inline-block");e("#markItUpeditor").css("display","inline-block");});e("#tabs_kunena_editor a:last").click(function(g){c.hide();e("#markItUpeditor").hide();});if(e("#kemojis_allowed").val()===1){var d="";if(c.length>0&&b.length===0){d="#editor";}else{if(b.length>0){d=".qreply";}}if(e("#wysibb-body").length>0){d="#wysibb-body";}if(d!==undefined){e(d).atwho({at:":",displayTpl:"<li data-value='${key}'>${name} <img src='${url}' height='20' width='20' /></li>",insertTpl:"${name}",callbacks:{remoteFilter:function(g,h){if(g.length>0){e.ajax({url:e("#kurl_emojis").val(),data:{search:g}}).done(function(i){h(i.emojis);}).fail(function(){});}}}});}}if(d!==undefined){var f=e("#kurl_users").val();e(d).atwho({at:"@",data:f,limit:5});}if(e.fn.sisyphus!==undefined){e("#postform").sisyphus({locationBased:true,timeout:5});}e("#kshow_attach_form").click(function(){if(e("#kattach_form").is(":visible")){e("#kattach_form").hide();}else{e("#kattach_form").show();}});e("#form_submit_button").click(function(){e("#subject").attr("required","required");e("#editor").attr("required","required");});var a;e("#postcatid").change(function(){var h=e("select#postcatid option").filter(":selected").val();var i=e("#kurl_topicons_request").val();if(e("#kanynomous-check").length>0){var g=jQuery.parseJSON(Joomla.getOptions("com_kunena.arrayanynomousbox"));if(g[h]!==undefined){e("#kanynomous-check").show();e("#kanonymous").prop("checked",true);}else{e("#kanynomous-check").hide();e("#kanonymous").prop("checked",false);}}e.ajax({type:"POST",url:i,async:true,dataType:"json",data:{catid:h}}).done(function(l){e("#iconset_topic_list").remove();var k=e("<div>",{id:"iconset_topic_list"});e("#iconset_inject").append(k);e.each(l,function(o,p){if(p.type!=="system"){if(p.id===0){var m=e("<input>",{type:"radio",id:"radio"+p.id,name:"topic_emoticon",value:p.id}).prop("checked",true);}else{var m=e("<input>",{type:"radio",id:"radio"+p.id,name:"topic_emoticon",value:p.id});}var q=e("<span>",{"class":"kiconsel"}).append(m);if(Joomla.getOptions("com_kunena.kunena_topicicontype")==="B2"){var n=e("<label>",{"class":"radio inline","for":"radio"+p.id}).append(e("<span>",{"class":"icon icon-topic icon-"+p.b2,border:"0",al:""}));}else{if(Joomla.getOptions("com_kunena.kunena_topicicontype")==="fa"){var n=e("<label>",{"class":"radio inline","for":"radio"+p.id}).append(e("<i>",{"class":"fa glyphicon-topic fa-2x fa-"+p.fa,border:"0",al:""}));}else{var n=e("<label>",{"class":"radio inline","for":"radio"+p.id}).append(e("<img>",{src:p.path,border:"0",al:""}));}}q.append(n);e("#iconset_topic_list").append(q);}});}).fail(function(){});a=function j(){return e.ajax({type:"POST",url:e("#kurl_category_template_text").val(),async:true,dataType:"json",data:{catid:h}}).done(function(k){if(e("#editor").val().length>1){if(e("#editor").val().length>1){e("#modal_confirm_template_category").modal("show");}else{e("#editor").val(a);}}else{if(k.length>1){e("#modal_confirm_template_category").modal("show");}else{e("#editor").val(k);}}}).fail(function(){});}();});e("#modal_confirm_erase").click(function(){e("#modal_confirm_template_category").modal("hide");var g=e("#editor").next();g.empty();e("#editor").val(a.responseJSON);});e("#modal_confirm_erase_keep_old").click(function(){e("#modal_confirm_template_category").modal("hide");var h=c.val();var g=e("#editor").next();g.empty();e("#editor").val(a.responseJSON+" "+h);});if(e.fn.datepicker!==undefined){e("#datepoll-container .input-append.date").datepicker({orientation:"top auto"});}if(e("gotoeditor")!==undefined){e("gotoeditor").on("click",function(){if(b.length>0){var g=localStorage.setItem("copyKunenaeditor",b.val());console.log(g);}},false);}});