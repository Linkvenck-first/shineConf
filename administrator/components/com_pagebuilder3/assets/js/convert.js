"use strict";jQuery(document).ready(function(){function b(){return new Promise(function(n){i.get("index.php?pb3ajax=1&task=revertBackUp").complete(function(o){n(o.responseJSON)})})}function c(){function n(){if(p=100*((q+1)/o.length),i("#convert-view-label").html("Converting... "+q+" / "+o.length+" items"),q<o.length){var r=o[q];k=i(r).data("pageid").toString(),l=i(r).data("pagetype"),m=i(r).attr("id"),window.pagefly_data={baseURL:j,page_id:k,_id:m,convert_mode:!0},d(k,"content").then(function(s){var t=s.match(/<!-- Start PageBuilder Data\|(.*)\|End PageBuilder Data -->/);f(k,t,m).then(function(u){var v=u.pages[m];console.log(v),v.renderHTML(function(w){if(w){var x=JSON.stringify(v.data),y="<!-- Start New PageBuilder HTML -->";y+=w,y+="<!-- End New PageBuilder HTML -->",y+="<!-- Start New PageBuilder Data|",y+=btoa(unescape(encodeURIComponent(x))),y+="|End New PageBuilder Data -->",g(k,l).then(function(z){z&&q==o.length-1&&i("#convert-backup").removeClass("hidden"),h(y,k,l).then(function(A){!1==A&&console.log("Error when save data: ",l,k),++q,i("#convert-view-progress-bar").css("width",p+"%"),i("#convert-view-progress-bar").html(p+"%"),100===p&&i("#convert-view-progress-bar").addClass("bar-success"),setTimeout(function(){console.log("Next....."),n()},1e3)})})}})})})}}var o=i(".pb-convert");0<o.length&&i("#convert-progress").removeClass("hidden");var p=0,q=0;0<o.length?(i("#convert-view-label").html("Converting... "+q+" / "+o.length+" items"),n()):i("#convert-view-label").html("Nothing to convert...")}function d(n,o){return new Promise(function(p){i.get("index.php?pb3ajax=1&task=getContentByID&id="+n+"&type="+o).complete(function(q){p(q.responseJSON)})})}function f(n,o,p){return new Promise(function(q){requirejs(["pagefly"],function(r){try{o=o?JSON.parse(decodeURIComponent(escape(atob(o[1])))):{}}catch(s){o={}}finally{o.textArea=document.getElementById(p),o.page_id=n,o._id=p,o.massConvert=!0,r.setPublicPath(j+"plugins/editors/pagebuilder3/assets/app/"),r.init(o,i("<div id=\"pb_editor_"+n+"\" class=\"hidden\">").insertAfter("#"+p).get(0)).then(function(s){console.log(s),q(window.pb),i("#pagefly-pb-app").addClass("hidden")}),i("#"+p).addClass("hidden")}})})}function g(n,o){return new Promise(function(p){i.get("index.php?pb3ajax=1&task=backupContent&id="+n+"&type="+o).complete(function(q){p(q.responseText)})})}function h(n,o,p){return new Promise(function(q){i.ajax({type:"POST",url:"index.php?pb3ajax=1&task=saveContent",data:{pb_data:n,id:o,type:p}}).complete(function(r){q(r)})})}var i=jQuery,j=window.pb_baseUrl,k,l,m;(function(){return new Promise(function(n){i.get("index.php?pb3ajax=1&task=checkBackup").complete(function(o){console.log("Backed up:",+o.responseJSON),0<+o.responseJSON?n(!0):n(!1)})})})().then(function(n){0===i(".pb-convert").length&&i("#convert-confirm").addClass("hidden"),n&&(i("#convert-backup").removeClass("hidden"),i("#convert-backup").on("click",function(){confirm("Are you sure to revert your backup data?")&&b().then(function(){alert("Successfully revert all your backup data!"),i("#convert-backup").addClass("hidden"),window.location.reload()})}))}),i("#convert-confirm").on("click",function(){c()})});